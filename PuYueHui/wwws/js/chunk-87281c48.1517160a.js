(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-87281c48"],{"7f7f":function(t,s,e){var n=e("86cc").f,o=Function.prototype,a=/^\s*function ([^ (]*)/,i="name";i in o||e("9e1e")&&n(o,i,{configurable:!0,get:function(){try{return(""+this).match(a)[1]}catch(t){return""}}})},a95f:function(t,s,e){},b74a:function(t,s,e){"use strict";var n=e("a95f"),o=e.n(n);o.a},c3d1:function(t,s,e){"use strict";e.r(s);var n=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"flexlayout"},[e("div",{staticClass:"topbar"},[e("span",{staticClass:"icon icon-fanhui",on:{click:function(s){t.$router.go(-1)}}}),e("div",[t._v("确认订单")]),e("router-link",{staticClass:"icon icon-home",attrs:{to:"/"}})],1),e("div",{staticClass:"flexauto"},[e("ul",{staticClass:"dingdanlist"},t._l(t.shoppings,function(s){return e("li",{key:s.id},[e("div",{staticClass:"wrap_img"},[e("img",{attrs:{src:t.attachmentUrl+s.product.logo,alt:s.product.name}}),2==s.type?e("span",{staticClass:"zhuanshu"},[t._v("专属商城")]):t._e()]),e("div",[e("h2",{staticClass:"productTitle"},[t._v(t._s(s.product.name))]),e("p",{staticClass:"price"},[t._v(t._s(t._f("formatMoney")(s.currentPrice)))]),e("p",[t._v("\n            规格："+t._s(s.product.year)+"年 "+t._s(s.product.capacity)+"\n            "),e("span",{staticStyle:{float:"right"}},[t._v("数量: "+t._s(s.productQuantity))])])])])})),e("ul",{staticClass:"list_common add"},[e("li",[e("div",{staticClass:"addinfo radioGroup"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.receiveType,expression:"receiveType"}],attrs:{type:"radio",id:"k1",name:"add",value:"1"},domProps:{checked:t._q(t.receiveType,"1")},on:{change:function(s){t.receiveType="1"}}}),e("label",{attrs:{for:"k1"}},[t._m(0),t.address?e("div",[t.address.receiver?e("p",{staticClass:"addressee"},[1==t.address.defaultAddr?e("span",{staticClass:"tag"},[t._v("默认")]):t._e(),e("strong",{staticClass:"name"},[t._v(t._s(t.address.receiver))]),e("span",{staticClass:"tel"},[t._v(t._s(t.address.mobile))])]):t._e(),t.address.fullAddress?e("p",{staticClass:"graytext"},[t._v(t._s(t.address.fullAddress))]):t._e()]):e("p",{staticClass:"addressee"},[e("strong",{staticClass:"graytext"},[t._v("请选择快递寄送收货地址")])])])]),e("router-link",{staticClass:"icon-fanhui",attrs:{to:{path:"/AddressSelect",query:{orderShoppingCartIds:this.$route.query.orderShoppingCartIds}}}})],1),e("li",[e("div",{staticClass:"addinfo radioGroup"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.receiveType,expression:"receiveType"}],attrs:{type:"radio",id:"k2",name:"add",value:"2"},domProps:{checked:t._q(t.receiveType,"2")},on:{change:function(s){t.receiveType="2"}}}),e("label",{attrs:{for:"k2"}},[t._m(1),t.store.storeName?e("p",{staticClass:"addressee"},[e("strong",{staticClass:"name"},[t._v(t._s(t.store.storeName))]),t._v("\n               \n              "),e("span",{staticClass:"tel"},[t._v(t._s(t.store.tel))])]):t._e(),t.store.address?e("p",{staticClass:"graytext"},[t._v(t._s(t.store.address))]):e("p",{staticClass:"addressee"},[e("strong",{staticClass:"graytext"},[t._v("请选择门店地址")])])])]),e("router-link",{staticClass:"icon-fanhui",attrs:{to:{path:"/AddressMendian",query:{orderShoppingCartIds:this.$route.query.orderShoppingCartIds}}}})],1)]),1==t.orderSubType?e("div",{staticClass:"selectCoupons",on:{click:function(s){t.popupVisible=!0}}},[e("span",[t._v("优惠券")]),e("span",[t._v(t._s(t.couponInfo))])]):t._e(),e("dl",{staticClass:"payment"},[e("dt",[t._v("选择支付方式")]),t.balance>=t.totalAmount?e("dd",{staticClass:"icon-puyuepay",class:{cur:"balance"===t.channel},on:{click:function(s){t.channel="balance"}}},[t._v("\n        账户余额支付(当前余额:\n        "),e("span",{staticClass:"red"},[t._v(t._s(t._f("formatMoney")(t.balance)))]),t._v(")\n      ")]):e("dd",{staticClass:"icon-puyuepay"},[t._v("\n        您的余额不足(当前余额:\n        "),e("span",{staticClass:"red"},[t._v(t._s(t._f("formatMoney")(t.balance)))]),t._v(")\n      ")]),t.isMicroMessengerMobile?e("dd",{staticClass:"icon-weixin icon-weixin-jsapi",class:{cur:"jsApiWxpay"===t.channel},on:{click:function(s){t.channel="jsApiWxpay"}}},[t._v("微信支付")]):e("dd",{staticClass:"icon-weixin",class:{cur:"wxpay"===t.channel},on:{click:function(s){t.channel="wxpay"}}},[t._v("微信支付")]),t.isMicroMessengerMobile?t._e():e("dd",{staticClass:"icon-zhifubao",class:{cur:"alipay"===t.channel},on:{click:function(s){t.channel="alipay"}}},[t._v("支付宝支付")]),2==t.orderSubType?e("dd",{staticClass:"icon-qian",class:{cur:"offline"===t.channel},on:{click:function(s){t.channel="offline"}}},[t._v("线下支付")]):t._e()])]),e("div",{staticClass:"jiesuan border-top"},[e("div",{staticClass:"total"},[e("p",[t._v("\n        共\n        "),e("span",{staticClass:"price"},[t._v(t._s(t.shoppings.length))]),t._v(" 件商品\n      ")]),e("p",[t._v("\n        快递：\n        "),e("span",{staticClass:"price"},[t._v(t._s(t._f("formatMoney")(t.totalExpressFee)))])])]),e("div",{staticStyle:{width:"35%"}},[t._v("\n      合计 ：\n      "),e("span",{staticClass:"price"},[t._v(t._s(t._f("formatMoney")(t.totalAmount)))])]),e("button",{staticClass:"btn",on:{click:t.createOrderInfo}},[t._v("结算")])]),e("mt-popup",{staticClass:"select_coupons",attrs:{position:"bottom"},model:{value:t.popupVisible,callback:function(s){t.popupVisible=s},expression:"popupVisible"}},[e("h2",[t._v("选择优惠券")]),e("ul",{staticClass:"coupons flexauto"},t._l(t.coupons,function(s){return e("li",{key:s.id,staticClass:"icon-youhuiquan",class:20==s.status||t.actualAmount<s.allMoney&&10!=s.threshold?"shixiao":10==s.threshold&&t.coupon1Id==s.id?"check cur":20==s.threshold&&t.coupon2Id==s.id?"cur":10==s.threshold?"check":"",on:{click:function(e){t.selectCoupon(s.threshold,s)}}},[10==s.threshold?e("div",{staticClass:"info nothreshold"},[e("p",[e("span",{staticClass:"num"},[t._v(t._s(t._f("formatMoney")(s.minusMoney)))])]),e("p",[t._v("无门槛优惠券")])]):t._e(),20==s.threshold?e("div",{staticClass:"info"},[e("p",[e("span",{staticClass:"num"},[t._v(t._s(t._f("formatMoney")(s.minusMoney)))])]),e("p",[t._v(t._s(s.name))])]):t._e(),20==s.status?e("em",[t._v("冻结中")]):t.actualAmount<s.allMoney&&10!=s.threshold?e("em",[t._v("未满足条件")]):t._e()])})),e("div",{staticClass:"btnGroup"},[e("div",{staticClass:"bigBtn",on:{click:function(s){t.calculateCoupon()}}},[t._v("确认")]),e("div",{staticClass:"bigBtn",on:{click:function(s){t.cancleCoupon()}}},[t._v("不使用优惠券")])])])],1)},o=[function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("p",[e("strong",[t._v("快递寄送收货地址:")])])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("p",[e("strong",[t._v("门店自提:")])])}],a=(e("ac6a"),e("7f7f"),e("3a78")),i=e("5f87"),r=e("76a0"),c=(e("b893"),{name:"Querendingdan",data:function(){var t=this.$util._isMicroMessengerMobile(),s=this.$util._isIOSMobile();return{popupVisible:!1,attachmentUrl:this.GLOBAL.attachmentUrl,isMicroMessengerMobile:t,isIOSMobile:s,channel:t?"jsApiWxpay":"balance",receiveAddressId:null,address:this.$route.query.address?this.$route.query.address:{},store:this.$route.query.store?this.$route.query.store:{},receiveType:this.$route.query.store?2:1,orderSubType:"1",coupon1Id:null,coupon1:null,coupon2Id:null,coupon2:null,couponInfo:null,shoppings:[],coupons:[{threshold:"10",status:10,minusMoney:15,id:1},{threshold:"20",status:10,minusMoney:30,allMoney:200,id:2},{threshold:"20",status:20,minusMoney:80,allMoney:500,id:3},{threshold:"20",status:10,minusMoney:200,allMoney:1e3,id:4}],firstExpressFee:10,otherExpressFee:5,totalExpressFees:0,amount:0,actualAmount:0,balance:0}},created:function(){this.getUserCoupons(),this.getExpressFees(),this.getUserBalance(),this.showOrderShoppings(),this.$route.query.address||this.memberAddrSelectDefault(),window.gotoSuccessPayResults=this.gotoSuccessPayResults},methods:{selectCoupon:function(t,s){if(!(20==s.status||this.actualAmount<s.allMoney&&10!=s.threshold)){var e=s.id;10==t?this.coupon1Id==e?(this.coupon1Id=null,this.coupon1=null):(this.coupon1Id=e,this.coupon1=s):this.coupon2Id==e?(this.coupon2Id=null,this.coupon2=null):(this.coupon2Id=e,this.coupon2=s)}},calculateCoupon:function(){this.popupVisible=!1,this.couponInfo="",this.coupon1&&(this.couponInfo=this.coupon1.name),this.coupon2&&(this.couponInfo+=";"+this.coupon2.name)},cancleCoupon:function(){this.popupVisible=!1,this.couponInfo="",this.coupon1Id=null,this.coupon1=null,this.coupon2Id=null,this.coupon2=null},showOrderShoppings:function(){var t=this,s={ids:this.$route.query.orderShoppingCartIds};s.ids&&s.ids.length>0&&a["a"].getOrderShoppings(s,function(s){t.shoppings=s.list,0==t.shoppings.length&&t.gotoShoppingcart()},function(t){console.error("获取选择的购物车编号列表的产品信息发生异常",JSON.stringify(t))})},memberAddrSelectDefault:function(){var t=this;t.store.id||a["a"].memberAddrSelectDefault(function(s){t.address=s},function(t){console.error("获取用户默认的收获地址发生异常",JSON.stringify(t))})},getUserCoupons:function(){var t=this;a["a"].getUserCoupons(function(s){t.coupons=s},function(t){console.error("获取用户的优惠券列表时发生异常",JSON.stringify(t))})},getExpressFees:function(){var t=this;a["a"].getExpressFees(function(s){t.firstExpressFee=s?s.key:10,t.otherExpressFee=s?s.value:5},function(t){console.error("获取快递费配置时发生异常",JSON.stringify(t))})},getUserBalance:function(){var t=this;a["a"].memberMoneySelect(function(s){t.balance=s?s.money:0},function(t){console.error("获取用户剩余资金信息发生异常",JSON.stringify(t))})},createOrderInfo:function(){var t=this,s=null;if(1==t.receiveType){if(!t.address||!t.address.id)return void Object(r["Toast"])("请选择您快递寄送的收货地址");s=t.address.id}else if(2==t.receiveType){if(!t.store||!t.store.id)return void Object(r["Toast"])("请选择您上门自提的门店地址");s=t.store.id}"jsApiWxpay"===t.channel?t.createAndPay(s):"balance"===t.channel?Object(r["MessageBox"])({title:"余额支付",message:"请输入登录密码",showInput:!0,inputType:"password",inputPlaceholder:"请输入登录密码",showCancelButton:!0,inputErrorMessage:"用户密码输入错误",closeOnClickModal:!1},function(e,n){t.$util.restore(),"confirm"==n&&a["a"].checkPassword({password:e},function(e){e?t.createAndPay(s):Object(r["Toast"])("密码错误,请重新输入")},function(t){console.error("密码检验接口调用异常"+JSON.stringify(t))})}):t.createAndPay(s)},createAndPay:function(t){var s=this;if(s.amount<=0)Object(r["Toast"])("对不起,暂不支持支付金额小于等于0的订单");else{var e={orderShoppingCartIds:this.$route.query.orderShoppingCartIds,orderSubType:s.shoppings[0].type,receiveType:this.receiveType,receiveAddressId:t,channel:"jsApiWxpay"==this.channel?"wxpay":this.channel,amount:this.amount,expressFee:this.totalExpressFees,coupon1Id:this.coupon1Id,coupon2Id:this.coupon2Id};this.shoppings.length>0?a["a"].createOrderInfo(e,function(t){t?(console.log("新建的订单编号",t),"balance"===s.channel?s.balance>=s.amount?a["a"].balancePay(t,function(t){Object(r["Toast"])("余额支付"+(t?"成功":"失败")),s.gotoAllOrdes()},function(t){console.error("余额支付异常"+JSON.stringify(t))}):Object(r["Toast"])("您的余额不足!"):"alipay"===s.channel?(a["a"].alipay(t),s.isIOSMobile?s.gotoSuccessPayResults():s.gotoAllOrdes()):"jsApiWxpay"===s.channel?(s.wxjsapipay(t),s.gotoAllOrdes()):"wxpay"===s.channel?(a["a"].wxpay(t,function(t){t&&(window.location.href=t)},function(t){console.error("发起微信支付发生异常"+JSON.stringify(t))}),s.isIOSMobile?s.gotoSuccessPayResults():s.gotoAllOrdes()):"offline"===s.channel&&2==s.orderSubType&&(Object(r["Toast"])("您选择的线下支付方式,请线下支付完成后联系葡悦汇"),s.gotoAllOrdes())):Object(r["Toast"])("订单创建失败")},function(t){console.error("添加订单异常"+JSON.stringify(t))}):Object(r["Toast"])("商品已被购买")}},gotoShoppingcart:function(){var t=this;t.$router.push({name:"Shoppingcart",query:{tab:3}})},gotoAllOrdes:function(){var t=this;t.$router.push({name:"Dingdan",query:{payOrderState:100}})},gotoPayResults:function(t,s){var e=this;e.$router.push({name:"PayResults",query:{result:t,amount:s}})},gotoSuccessPayResults:function(){var t=this;t.gotoPayResults(!0,t.amount)},wxjsapipay:function(t){var s={},e=function(){WeixinJSBridge.invoke("getBrandWCPayRequest",{debug:!0,appId:s.appId,timeStamp:s.timeStamp,nonceStr:s.nonceStr,package:s.package,signType:s.signType,paySign:s.paySign,jsApiList:["chooseWXPay"]},function(t){"get_brand_wcpay_request:ok"==t.err_msg&&(Object(r["Toast"])("支付成功"),this_.gotoAllOrdes()),"get_brand_wcpay_request:cancel"==t.err_msg&&(Object(r["Toast"])("取消支付"),this_.gotoAllOrdes())})},n=function(){"undefined"==typeof WeixinJSBridge?document.addEventListener?document.addEventListener("WeixinJSBridgeReady",e,!1):document.attachEvent&&(document.attachEvent("WeixinJSBridgeReady",e),document.attachEvent("onWeixinJSBridgeReady",e)):e()},o=Object(i["d"])();o?a["a"].jsApiWxpay(t,{openId:o},function(t){s=t,n()},function(t){console.error("获取微信公众号支付信息时发生异常",JSON.stringify(t))}):Object(r["Toast"])("请通过微信公众号菜单进入商品支付")}},computed:{totalExpressFee:function(){var t=0;return this.shoppings&&this.shoppings.length>0&&(this.orderSubType=this.shoppings[0].type,"1"==this.receiveType&&"1"==this.orderSubType&&(t=5,this.shoppings.forEach(function(s){t+=parseFloat(5*s.productQuantity)}))),this.totalExpressFees=t,t},totalAmount:function(){var t=0;return this.shoppings&&this.shoppings.forEach(function(s){t+=parseFloat(s.productQuantity*s.currentPrice)}),this.amount=parseFloat(t)+parseFloat(this.totalExpressFee),this.actualAmount=this.amount,this.coupon1&&(this.actualAmount=this.actualAmount-this.coupon1.minusMoney),this.coupon2&&(this.actualAmount=this.actualAmount-this.coupon2.minusMoney),this.amount=this.actualAmount,this.channel=this.balance>=this.amount?"balance":this.isMicroMessengerMobile?"jsApiWxpay":"alipay",this.amount}}}),u=c,l=(e("b74a"),e("2877")),p=Object(l["a"])(u,n,o,!1,null,"72d50338",null);p.options.__file="Querendingdan.vue";s["default"]=p.exports}}]);