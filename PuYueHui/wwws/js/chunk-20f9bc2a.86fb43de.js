(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-20f9bc2a"],{a97b:function(e,t,s){"use strict";var a=s("e8c1"),n=s.n(a);n.a},c3d1:function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("div",{staticClass:"topbar"},[s("span",{staticClass:"icon icon-fanhui",on:{click:function(t){e.$router.go(-1)}}}),s("div",[e._v("确认订单")]),s("router-link",{staticClass:"icon icon-home",attrs:{to:"/"}})],1),s("ul",{staticClass:"dingdanlist",staticStyle:{"padding-top":".88rem"}},e._l(e.shoppings,function(t){return s("li",{key:t.id},[s("div",{staticClass:"wrap_img"},[s("img",{attrs:{src:e.attachmentUrl+t.product.logo,alt:t.product.name}}),2==t.type?s("span",{staticClass:"zhuanshu"},[e._v("专属商城")]):e._e()]),s("div",[s("h2",{staticClass:"productTitle"},[e._v(e._s(t.product.name))]),s("p",{staticClass:"price"},[e._v(e._s(e._f("formatMoney")(t.currentPrice)))]),s("p",[e._v("\n          规格："+e._s(t.product.year)+"年 "+e._s(t.product.capacity)+"\n          "),s("span",{staticStyle:{float:"right"}},[e._v("数量: "+e._s(t.productQuantity))])])])])})),s("ul",{staticClass:"list_common add"},[s("li",[s("div",{staticClass:"addinfo radioGroup"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.receiveType,expression:"receiveType"}],attrs:{type:"radio",id:"k1",name:"add",value:"1"},domProps:{checked:e._q(e.receiveType,"1")},on:{change:function(t){e.receiveType="1"}}}),s("label",{attrs:{for:"k1"}},[e._m(0),e.address?s("div",[e.address.receiver?s("p",{staticClass:"addressee"},[1==e.address.defaultAddr?s("span",{staticClass:"tag"},[e._v("默认")]):e._e(),s("strong",{staticClass:"name"},[e._v(e._s(e.address.receiver))]),s("span",{staticClass:"tel"},[e._v(e._s(e.address.mobile))])]):e._e(),e.address.fullAddress?s("p",{staticClass:"graytext"},[e._v(e._s(e.address.fullAddress))]):e._e()]):s("p",{staticClass:"addressee"},[s("strong",{staticClass:"graytext"},[e._v("请选择快递寄送收货地址")])])])]),s("router-link",{staticClass:"icon-fanhui",attrs:{to:{path:"/AddressSelect",query:{orderShoppingCartIds:this.$route.query.orderShoppingCartIds}}}})],1),s("li",[s("div",{staticClass:"addinfo radioGroup"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.receiveType,expression:"receiveType"}],attrs:{type:"radio",id:"k2",name:"add",value:"2"},domProps:{checked:e._q(e.receiveType,"2")},on:{change:function(t){e.receiveType="2"}}}),s("label",{attrs:{for:"k2"}},[e._m(1),e.store.storeName?s("p",{staticClass:"addressee"},[s("strong",{staticClass:"name"},[e._v(e._s(e.store.storeName))]),e._v("\n             \n            "),s("span",{staticClass:"tel"},[e._v(e._s(e.store.tel))])]):e._e(),e.store.address?s("p",{staticClass:"graytext"},[e._v(e._s(e.store.address))]):s("p",{staticClass:"addressee"},[s("strong",{staticClass:"graytext"},[e._v("请选择门店地址")])])])]),s("router-link",{staticClass:"icon-fanhui",attrs:{to:{path:"/AddressMendian",query:{orderShoppingCartIds:this.$route.query.orderShoppingCartIds}}}})],1)]),s("dl",{staticClass:"payment",staticStyle:{"margin-bottom":"1rem"}},[s("dt",[e._v("选择支付方式")]),e.balance>=e.totalAmount?s("dd",{staticClass:"icon-puyuepay",class:{cur:"balance"===e.channel},on:{click:function(t){e.channel="balance"}}},[e._v("\n      账户余额支付(当前余额:\n      "),s("span",{staticClass:"red"},[e._v(e._s(e._f("formatMoney")(e.balance)))]),e._v(")\n    ")]):s("dd",{staticClass:"icon-puyuepay"},[e._v("\n      您的余额不足(当前余额:\n      "),s("span",{staticClass:"red"},[e._v(e._s(e._f("formatMoney")(e.balance)))]),e._v(")\n    ")]),e.isMicroMessengerMobile?s("dd",{staticClass:"icon-weixin icon-weixin-jsapi",class:{cur:"jsApiWxpay"===e.channel},on:{click:function(t){e.channel="jsApiWxpay"}}},[e._v("微信支付")]):s("dd",{staticClass:"icon-weixin",class:{cur:"wxpay"===e.channel},on:{click:function(t){e.channel="wxpay"}}},[e._v("微信支付")]),e.isMicroMessengerMobile?e._e():s("dd",{staticClass:"icon-zhifubao",class:{cur:"alipay"===e.channel},on:{click:function(t){e.channel="alipay"}}},[e._v("支付宝支付")]),2==e.orderSubType?s("dd",{staticClass:"icon-qian",class:{cur:"offline"===e.channel},on:{click:function(t){e.channel="offline"}}},[e._v("线下支付")]):e._e()]),s("div",{staticClass:"jiesuan border-top",staticStyle:{position:"fixed",bottom:"0"}},[s("div",{staticClass:"total"},[s("p",[e._v("\n        共\n        "),s("span",{staticClass:"price"},[e._v(e._s(e.shoppings.length))]),e._v(" 件商品\n      ")]),s("p",[e._v("\n        快递费：\n        "),s("span",{staticClass:"price"},[e._v(e._s(e._f("formatMoney")(e.totalExpressFee)))])])]),s("div",{staticStyle:{width:"40%"}},[e._v("\n      合计 ：\n      "),s("span",{staticClass:"price"},[e._v(e._s(e._f("formatMoney")(e.totalAmount)))])]),s("button",{staticClass:"btn",on:{click:e.createOrderInfo}},[e._v("结算")])])])},n=[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("p",[s("strong",[e._v("快递寄送收货地址:")])])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("p",[s("strong",[e._v("门店自提:")])])}],i=(s("ac6a"),s("cadf"),s("551c"),s("097d"),s("3a78")),r=s("5f87"),o=s("76a0"),c={name:"Querendingdan",data:function(){var e=this.$util._isMicroMessengerMobile(),t=this.$util._isIOSMobile();return{attachmentUrl:this.GLOBAL.attachmentUrl,isMicroMessengerMobile:e,isIOSMobile:t,channel:e?"jsApiWxpay":"balance",receiveAddressId:null,address:this.$route.query.address?this.$route.query.address:{},store:this.$route.query.store?this.$route.query.store:{},receiveType:this.$route.query.store?2:1,orderSubType:"1",shoppings:[],firstExpressFee:10,otherExpressFee:5,totalexpressFees:0,amount:0,balance:0}},created:function(){this.getExpressFees(),this.getUserBalance(),this.showOrderShoppings(),this.$route.query.address||this.memberAddrSelectDefault(),window.gotoSuccessPayResults=this.gotoSuccessPayResults},methods:{showOrderShoppings:function(){var e=this,t={ids:this.$route.query.orderShoppingCartIds};t.ids&&t.ids.length>0&&i["a"].getOrderShoppings(t,function(t){e.shoppings=t.list,0==e.shoppings.length&&e.gotoShoppingcart()},function(e){console.error("获取选择的购物车编号列表的产品信息发生异常",JSON.stringify(e))})},memberAddrSelectDefault:function(){var e=this;e.store.id||i["a"].memberAddrSelectDefault(function(t){e.address=t},function(e){console.error("获取用户默认的收获地址发生异常",JSON.stringify(e))})},getExpressFees:function(){var e=this;i["a"].getExpressFees(function(t){e.firstExpressFee=t?t.key:10,e.otherExpressFee=t?t.value:5},function(e){console.error("获取快递费配置时发生异常",JSON.stringify(e))})},getUserBalance:function(){var e=this;i["a"].memberMoneySelect(function(t){e.balance=t?t.money:0},function(e){console.error("获取用户剩余资金信息发生异常",JSON.stringify(e))})},createOrderInfo:function(){var e=this,t=null;if(1==e.receiveType){if(!e.address||!e.address.id)return void Object(o["Toast"])("请选择您快递寄送的收货地址");t=e.address.id}else if(2==e.receiveType){if(!e.store||!e.store.id)return void Object(o["Toast"])("请选择您上门自提的门店地址");t=e.store.id}"jsApiWxpay"===e.channel?e.createAndPay(t):"balance"===e.channel?Object(o["MessageBox"])({title:"余额支付",message:"请输入登录密码",showInput:!0,inputType:"password",inputPlaceholder:"请输入登录密码",showCancelButton:!0,inputErrorMessage:"用户密码输入错误"},function(s,a){"confirm"==a&&i["a"].checkPassword({password:s},function(s){s?e.createAndPay(t):Object(o["Toast"])("密码错误,请重新输入")},function(e){console.error("密码检验接口调用异常"+JSON.stringify(e))})}):e.createAndPay(t)},createAndPay:function(e){var t=this,s={orderShoppingCartIds:this.$route.query.orderShoppingCartIds,orderSubType:t.shoppings[0].type,receiveType:this.receiveType,receiveAddressId:e,channel:"jsApiWxpay"==this.channel?"wxpay":this.channel,expressFee:this.totalExpressFees};this.shoppings.length>0?i["a"].createOrderInfo(s,function(e){e?(console.log("新建的订单编号",e),"balance"===t.channel?t.balance>=t.amount?i["a"].balancePay(e,function(e){Object(o["Toast"])("余额支付"+(e?"成功":"失败")),t.gotoAllOrdes()},function(e){console.error("余额支付异常"+JSON.stringify(e))}):Object(o["Toast"])("您的余额不足!"):"alipay"===t.channel?(i["a"].alipay(e),t.isIOSMobile?t.waitGotoPayResults(!0,t.amount):t.gotoAllOrdes()):"jsApiWxpay"===t.channel?(t.wxjsapipay(e),t.gotoAllOrdes()):"wxpay"===t.channel?(i["a"].wxpay(e,function(e){e&&(window.location.href=e)},function(e){console.error("发起微信支付发生异常"+JSON.stringify(e))}),t.isIOSMobile?t.waitGotoPayResults(!0,t.amount):t.gotoAllOrdes()):"offline"===t.channel&&2==t.orderSubType&&(Object(o["Toast"])("您选择的线下支付方式,请线下支付完成后联系葡悦汇"),t.gotoAllOrdes())):Object(o["Toast"])("订单创建失败")},function(e){console.error("添加订单异常"+JSON.stringify(e))}):Object(o["Toast"])("商品已被购买")},gotoShoppingcart:function(){var e=this;e.$router.push({name:"Shoppingcart",query:{tab:3}})},gotoAllOrdes:function(){var e=this;e.$router.push({name:"Dingdan",query:{payOrderState:100}})},gotoPayResults:function(e,t){var s=this;s.$router.push({name:"PayResults",query:{result:e,amount:t}})},gotoSuccessPayResults:function(){var e=this;e.$router.push({name:"PayResults",query:{result:!0}})},waitGotoPayResults:function(e,t){var s=this;s.gotoPayResults(e,t)},wxjsapipay:function(e){var t={},s=function(){WeixinJSBridge.invoke("getBrandWCPayRequest",{debug:!0,appId:t.appId,timeStamp:t.timeStamp,nonceStr:t.nonceStr,package:t.package,signType:t.signType,paySign:t.paySign,jsApiList:["chooseWXPay"]},function(e){"get_brand_wcpay_request:ok"==e.err_msg&&(Object(o["Toast"])("支付成功"),this_.gotoAllOrdes()),"get_brand_wcpay_request:cancel"==e.err_msg&&(Object(o["Toast"])("取消支付"),this_.gotoAllOrdes())})},a=function(){"undefined"==typeof WeixinJSBridge?document.addEventListener?document.addEventListener("WeixinJSBridgeReady",s,!1):document.attachEvent&&(document.attachEvent("WeixinJSBridgeReady",s),document.attachEvent("onWeixinJSBridgeReady",s)):s()},n=Object(r["c"])();n?i["a"].jsApiWxpay(e,{openId:n},function(e){t=e,a()},function(e){console.error("获取微信公众号支付信息时发生异常",JSON.stringify(e))}):Object(o["Toast"])("请通过微信公众号菜单进入商品支付")}},computed:{totalExpressFee:function(){var e=0;return this.shoppings&&this.shoppings.length>0&&(this.orderSubType=this.shoppings[0].type,"1"==this.receiveType&&"1"==this.orderSubType&&(e=5,this.shoppings.forEach(function(t){e+=parseFloat(5*t.productQuantity)}))),this.totalExpressFees=e,e},totalAmount:function(){var e=0;return this.shoppings&&this.shoppings.forEach(function(t){e+=parseFloat(t.productQuantity*t.currentPrice)}),this.amount=parseFloat(e)+parseFloat(this.totalExpressFee),this.channel=this.balance>=this.amount?"balance":this.isMicroMessengerMobile?"jsApiWxpay":"alipay",this.amount}}},l=c,d=(s("a97b"),s("2877")),p=Object(d["a"])(l,a,n,!1,null,"5a3ee7d9",null);p.options.__file="Querendingdan.vue";t["default"]=p.exports},e8c1:function(e,t,s){}}]);