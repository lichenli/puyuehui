(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-c223151a"],{"64a8":function(e,t,s){"use strict";var o=s("d117"),n=s.n(o);n.a},"7f7f":function(e,t,s){var o=s("86cc").f,n=Function.prototype,i=/^\s*function ([^ (]*)/,a="name";a in n||s("9e1e")&&o(n,a,{configurable:!0,get:function(){try{return(""+this).match(i)[1]}catch(e){return""}}})},c3d1:function(e,t,s){"use strict";s.r(t);var o=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"flexlayout"},[s("div",{staticClass:"topbar"},[s("span",{staticClass:"icon icon-fanhui",on:{click:function(t){e.$router.go(-1)}}}),s("div",[e._v("确认订单")]),s("router-link",{staticClass:"icon icon-home",attrs:{to:"/"}})],1),s("div",{staticClass:"flexauto"},[s("ul",{staticClass:"dingdanlist"},e._l(e.shoppings,function(t){return s("li",{key:t.id},[s("div",{staticClass:"wrap_img"},[s("img",{attrs:{src:e.attachmentUrl+t.product.logo,alt:t.product.name}}),2==t.type?s("span",{staticClass:"zhuanshu"},[e._v("专属商城")]):e._e()]),s("div",[s("h2",{staticClass:"productTitle"},[e._v(e._s(t.product.name))]),s("p",{staticClass:"price"},[e._v(e._s(e._f("formatMoney")(t.currentPrice)))]),s("p",[e._v("\n            规格："+e._s(t.product.year)+"年 "+e._s(t.product.capacity)+"\n            "),s("span",{staticStyle:{float:"right"}},[e._v("数量: "+e._s(t.productQuantity))])])])])})),s("ul",{staticClass:"list_common add"},[s("li",[s("div",{staticClass:"addinfo radioGroup"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.receiveType,expression:"receiveType"}],attrs:{type:"radio",id:"k1",name:"add",value:"1"},domProps:{checked:e._q(e.receiveType,"1")},on:{click:function(t){e.storeReceiveType(1)},change:function(t){e.receiveType="1"}}}),s("label",{attrs:{for:"k1"}},[e._m(0),e.address?s("div",[e.address.receiver?s("p",{staticClass:"addressee"},[1==e.address.defaultAddr?s("span",{staticClass:"tag"},[e._v("默认")]):e._e(),s("strong",{staticClass:"name"},[e._v(e._s(e.address.receiver))]),s("span",{staticClass:"tel"},[e._v(e._s(e.address.mobile))])]):e._e(),e.address.fullAddress?s("p",{staticClass:"graytext"},[e._v(e._s(e.address.fullAddress))]):e._e()]):s("p",{staticClass:"addressee"},[s("strong",{staticClass:"graytext"},[e._v("请选择快递寄送收货地址")])])])]),s("router-link",{staticClass:"icon-fanhui",attrs:{to:{path:"/AddressSelect",query:{orderShoppingCartIds:this.$route.query.orderShoppingCartIds}}}})],1),s("li",[s("div",{staticClass:"addinfo radioGroup"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.receiveType,expression:"receiveType"}],attrs:{type:"radio",id:"k2",name:"add",value:"2"},domProps:{checked:e._q(e.receiveType,"2")},on:{click:function(t){e.storeReceiveType(2)},change:function(t){e.receiveType="2"}}}),s("label",{attrs:{for:"k2"}},[e._m(1),e.store?s("p",{staticClass:"addressee"},[s("strong",{staticClass:"name"},[e._v(e._s(e.store.storeName))]),e._v("\n               \n              "),s("span",{staticClass:"tel"},[e._v(e._s(e.store.tel))])]):e._e(),e.store?s("p",{staticClass:"graytext"},[e._v(e._s(e.store.address))]):s("p",{staticClass:"addressee"},[s("strong",{staticClass:"graytext"},[e._v("请选择门店地址")])])])]),s("router-link",{staticClass:"icon-fanhui",attrs:{to:{path:"/AddressMendian",query:{orderShoppingCartIds:this.$route.query.orderShoppingCartIds}}}})],1)]),s("div",[s("router-link",{staticClass:"infolist",attrs:{to:{path:"/Invoice",query:{orderShoppingCartIds:this.$route.query.orderShoppingCartIds}}}},[s("em",[e._v("发票")]),s("span",[e._v(e._s(e.invoice?(1==e.invoice.mode?"电子":"纸质")+"发票 - "+(1==e.invoice.type?"个人":"企业")+" - "+e.invoice.name:"本次不开具发票"))])])],1),s("div",{staticClass:"infolist"},[s("em",[e._v("备注")]),s("input",{directives:[{name:"model",rawName:"v-model",value:e.remark,expression:"remark"}],attrs:{type:"text",placeholder:"选填:填写内容需和客服确认"},domProps:{value:e.remark},on:{input:[function(t){t.target.composing||(e.remark=t.target.value)},function(t){e.storeRemark(t.target.value)}],blur:this.$util.restore}})]),1==e.orderSubType?s("div",{staticClass:"selectCoupons",on:{click:function(t){e.popupVisible=!0}}},[s("span",[e._v("优惠券")]),s("span",[e._v(e._s(e.couponInfo))])]):e._e(),s("dl",{staticClass:"payment"},[s("dt",[e._v("选择支付方式")]),e.balance>=e.totalAmount?s("dd",{staticClass:"icon-puyuepay",class:{cur:"balance"===e.channel},on:{click:function(t){e.channel="balance"}}},[e._v("\n        账户余额支付(当前余额:\n        "),s("span",{staticClass:"red"},[e._v(e._s(e._f("formatMoney")(e.balance)))]),e._v(")\n      ")]):s("dd",{staticClass:"icon-puyuepay"},[e._v("\n        您的余额不足(当前余额:\n        "),s("span",{staticClass:"red"},[e._v(e._s(e._f("formatMoney")(e.balance)))]),e._v(")\n      ")]),e.isMicroMessengerMobile?s("dd",{staticClass:"icon-weixin icon-weixin-jsapi",class:{cur:"jsApiWxpay"===e.channel},on:{click:function(t){e.channel="jsApiWxpay"}}},[e._v("微信支付")]):s("dd",{staticClass:"icon-weixin",class:{cur:"wxpay"===e.channel},on:{click:function(t){e.channel="wxpay"}}},[e._v("微信支付")]),e.isMicroMessengerMobile?e._e():s("dd",{staticClass:"icon-zhifubao",class:{cur:"alipay"===e.channel},on:{click:function(t){e.channel="alipay"}}},[e._v("支付宝支付")]),2==e.orderSubType?s("dd",{staticClass:"icon-qian",class:{cur:"offline"===e.channel},on:{click:function(t){e.channel="offline"}}},[e._v("线下支付")]):e._e()])]),s("div",{staticClass:"jiesuan border-top"},[s("div",{staticClass:"total"},[s("p",[e._v("\n        共\n        "),s("span",{staticClass:"price"},[e._v(e._s(e.shoppings.length))]),e._v(" 件商品\n      ")]),s("p",[e._v("\n        快递：\n        "),s("span",{staticClass:"price"},[e._v(e._s(e._f("formatMoney")(e.totalExpressFee)))])])]),s("div",{staticStyle:{width:"35%"}},[e._v("\n      合计 ：\n      "),s("span",{staticClass:"price"},[e._v(e._s(e._f("formatMoney")(e.totalAmount)))])]),s("button",{staticClass:"btn",on:{click:e.createOrderInfo}},[e._v("结算")])]),s("mt-popup",{staticClass:"select_coupons",attrs:{position:"bottom"},model:{value:e.popupVisible,callback:function(t){e.popupVisible=t},expression:"popupVisible"}},[s("h2",[e._v("选择优惠券")]),s("ul",{staticClass:"coupons flexauto"},e._l(e.coupons,function(t){return s("li",{key:t.id,staticClass:"icon-youhuiquan",class:20==t.status||e.actualAmount<t.allMoney&&10!=t.threshold?"shixiao":10==t.threshold&&e.coupon1Id==t.id?"check cur":20==t.threshold&&e.coupon2Id==t.id?"cur":10==t.threshold?"check":"",on:{click:function(s){e.selectCoupon(t.threshold,t)}}},[10==t.threshold?s("div",{staticClass:"info nothreshold"},[s("p",[s("span",{staticClass:"num"},[e._v(e._s(e._f("formatMoney")(t.minusMoney)))])]),s("p",[e._v("无门槛优惠券")])]):e._e(),20==t.threshold?s("div",{staticClass:"info"},[s("p",[s("span",{staticClass:"num"},[e._v(e._s(e._f("formatMoney")(t.minusMoney)))])]),s("p",[e._v(e._s(t.name))])]):e._e(),20==t.status?s("em",[e._v("冻结中")]):e.actualAmount<t.allMoney&&10!=t.threshold?s("em",[e._v("未满足条件")]):e._e()])})),s("div",{staticClass:"btnGroup"},[s("div",{staticClass:"bigBtn",on:{click:function(t){e.calculateCoupon()}}},[e._v("确认")]),s("div",{staticClass:"bigBtn",on:{click:function(t){e.cancleCoupon()}}},[e._v("不使用优惠券")])])])],1)},n=[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("p",[s("strong",[e._v("快递寄送收货地址:")])])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("p",[s("strong",[e._v("门店自提:")])])}],i=(s("ac6a"),s("7f7f"),s("3a78")),a=s("5f87"),r=s("76a0"),c=(s("b893"),{name:"Querendingdan",data:function(){var e=this.$util._isMicroMessengerMobile(),t=this.$util._isIOSMobile();return{popupVisible:!1,attachmentUrl:this.GLOBAL.attachmentUrl,isMicroMessengerMobile:e,isIOSMobile:t,channel:e?"jsApiWxpay":"balance",receiveAddressId:null,address:Object(a["a"])("order_address")?JSON.parse(Object(a["a"])("order_address")):null,store:Object(a["a"])("order_store")?JSON.parse(Object(a["a"])("order_store")):null,receiveType:this.$route.query.receiveType&&2==this.$route.query.receiveType?2:1,orderSubType:"1",coupon1Id:null,coupon1:null,coupon2Id:null,coupon2:null,couponInfo:null,shoppings:[],coupons:[],firstExpressFee:10,otherExpressFee:5,totalExpressFees:0,amount:0,actualAmount:0,balance:0,invoice:Object(a["a"])("order_invoice")?JSON.parse(Object(a["a"])("order_invoice")):null,remark:Object(a["a"])("order_remark")?Object(a["a"])("order_remark"):""}},created:function(){this.getUserCoupons(),this.getExpressFees(),this.getUserBalance(),this.showOrderShoppings(),this.address||this.memberAddrSelectDefault(),window.gotoSuccessPayResults=this.gotoSuccessPayResults},methods:{storeRemark:function(e){Object(a["h"])("order_remark",e)},storeReceiveType:function(e){this.receiveType=e,Object(a["h"])("order_receiveType",e)},selectCoupon:function(e,t){if(!(20==t.status||this.actualAmount<t.allMoney&&10!=t.threshold)){var s=t.id;10==e?this.coupon1Id==s?(this.coupon1Id=null,this.coupon1=null):(this.coupon1Id=s,this.coupon1=t):this.coupon2Id==s?(this.coupon2Id=null,this.coupon2=null):(this.coupon2Id=s,this.coupon2=t)}},calculateCoupon:function(){this.popupVisible=!1,this.couponInfo="",this.coupon1&&(this.couponInfo=this.coupon1.name),this.coupon2&&(this.couponInfo+=";"+this.coupon2.name)},cancleCoupon:function(){this.popupVisible=!1,this.couponInfo="",this.coupon1Id=null,this.coupon1=null,this.coupon2Id=null,this.coupon2=null},showOrderShoppings:function(){var e=this,t={ids:this.$route.query.orderShoppingCartIds};t.ids&&t.ids.length>0&&i["a"].getOrderShoppings(t,function(t){e.shoppings=t.list,0==e.shoppings.length&&e.gotoShoppingcart()},function(e){console.error("获取选择的购物车编号列表的产品信息发生异常",JSON.stringify(e))})},memberAddrSelectDefault:function(){var e=this;i["a"].memberAddrSelectDefault(function(t){e.address=t,e.store&&e.store.id?e.storeReceiveType(2):e.storeReceiveType(1)},function(e){console.error("获取用户默认的收获地址发生异常",JSON.stringify(e))})},getUserCoupons:function(){var e=this;i["a"].getUserCoupons(function(t){e.coupons=t},function(e){console.error("获取用户的优惠券列表时发生异常",JSON.stringify(e))})},getExpressFees:function(){var e=this;i["a"].getExpressFees(function(t){e.firstExpressFee=t?t.key:10,e.otherExpressFee=t?t.value:5},function(e){console.error("获取快递费配置时发生异常",JSON.stringify(e))})},getUserBalance:function(){var e=this;i["a"].memberMoneySelect(function(t){e.balance=t?t.money:0},function(e){console.error("获取用户剩余资金信息发生异常",JSON.stringify(e))})},createOrderInfo:function(){var e=this,t=null;if(1==e.receiveType){if(!e.address||!e.address.id)return void Object(r["Toast"])("请选择您快递寄送的收货地址");t=e.address.id}else if(2==e.receiveType){if(!e.store||!e.store.id)return void Object(r["Toast"])("请选择您上门自提的门店地址");t=e.store.id}"jsApiWxpay"===e.channel?e.createAndPay(t):"balance"===e.channel?Object(r["MessageBox"])({title:"余额支付",message:"请输入登录密码",showInput:!0,inputType:"password",inputPlaceholder:"请输入登录密码",showCancelButton:!0,inputErrorMessage:"用户密码输入错误",closeOnClickModal:!1},function(s,o){e.$util.restore(),"confirm"==o&&i["a"].checkPassword({password:s},function(s){s?e.createAndPay(t):Object(r["Toast"])("密码错误,请重新输入")},function(e){console.error("密码检验接口调用异常"+JSON.stringify(e))})}):e.createAndPay(t)},createAndPay:function(e){var t=this;if(t.amount<=0)Object(r["Toast"])("对不起,暂不支持支付金额小于等于0的订单");else{var s={orderShoppingCartIds:this.$route.query.orderShoppingCartIds,orderSubType:t.shoppings[0].type,receiveType:this.receiveType,receiveAddressId:e,channel:"jsApiWxpay"==this.channel?"wxpay":this.channel,amount:this.amount,expressFee:this.totalExpressFees,coupon1Id:this.coupon1Id,coupon2Id:this.coupon2Id,invoice:this.invoice?JSON.stringify(this.invoice):null,remark:this.remark};this.shoppings.length>0?(i["a"].createOrderInfo(s,function(e){if(e){var s=e.errorCode;if(s)return void("1"==s?Object(r["Toast"])("商品库存不足,无法创建订单"):"2"==s?Object(r["Toast"])("订单创建失败(商品不存在)"):"3"==s&&Object(r["Toast"])("订单创建失败(订单已创建)"));var o=e.orderId;o?(console.log("新建的订单编号",o),"balance"===t.channel?t.balance>=t.amount?i["a"].balancePay(o,function(e){Object(r["Toast"])("余额支付"+(e?"成功":"失败")),t.gotoAllOrdes()},function(e){console.error("余额支付异常"+JSON.stringify(e))}):Object(r["Toast"])("您的余额不足!"):"alipay"===t.channel?(i["a"].alipay(o),t.isIOSMobile?t.gotoSuccessPayResults():t.gotoAllOrdes()):"jsApiWxpay"===t.channel?(t.wxjsapipay(o),t.gotoAllOrdes()):"wxpay"===t.channel?(i["a"].wxpay(o,function(e){e&&(window.location.href=e)},function(e){console.error("发起微信支付发生异常"+JSON.stringify(e))}),t.isIOSMobile?t.gotoSuccessPayResults():t.gotoAllOrdes()):"offline"===t.channel&&2==t.orderSubType&&(Object(r["Toast"])("您选择的线下支付方式,请线下支付完成后联系葡悦汇"),t.gotoAllOrdes())):Object(r["Toast"])("订单创建异常")}else Object(r["Toast"])("订单创建失败")},function(e){console.error("添加订单异常"+JSON.stringify(e))}),Object(a["f"])("order_address"),Object(a["f"])("order_invoice"),Object(a["f"])("order_store"),Object(a["f"])("order_remark"),Object(a["f"])("order_receiveType")):Object(r["Toast"])("商品已被购买")}},gotoShoppingcart:function(){var e=this;e.$router.push({name:"Shoppingcart",query:{tab:3}})},gotoAllOrdes:function(){var e=this;e.$router.push({name:"Dingdan",query:{payOrderState:100}})},gotoPayResults:function(e,t){var s=this;s.$router.push({name:"PayResults",query:{result:e,amount:t}})},gotoSuccessPayResults:function(){var e=this;e.gotoPayResults(!0,e.amount)},wxjsapipay:function(e){var t={},s=function(){WeixinJSBridge.invoke("getBrandWCPayRequest",{debug:!0,appId:t.appId,timeStamp:t.timeStamp,nonceStr:t.nonceStr,package:t.package,signType:t.signType,paySign:t.paySign,jsApiList:["chooseWXPay"]},function(e){"get_brand_wcpay_request:ok"==e.err_msg&&(Object(r["Toast"])("支付成功"),this_.gotoAllOrdes()),"get_brand_wcpay_request:cancel"==e.err_msg&&(Object(r["Toast"])("取消支付"),this_.gotoAllOrdes())})},o=function(){"undefined"==typeof WeixinJSBridge?document.addEventListener?document.addEventListener("WeixinJSBridgeReady",s,!1):document.attachEvent&&(document.attachEvent("WeixinJSBridgeReady",s),document.attachEvent("onWeixinJSBridgeReady",s)):s()},n=Object(a["e"])();n?i["a"].jsApiWxpay(e,{openId:n},function(e){t=e,o()},function(e){console.error("获取微信公众号支付信息时发生异常",JSON.stringify(e))}):Object(r["Toast"])("请通过微信公众号[葡悦汇]的菜单[葡悦商城]进入商城后支付")}},computed:{totalExpressFee:function(){var e=0;return this.shoppings&&this.shoppings.length>0&&(this.orderSubType=this.shoppings[0].type,"1"==this.receiveType&&"1"==this.orderSubType&&(e=5,this.shoppings.forEach(function(t){e+=parseFloat(5*t.productQuantity)}))),this.totalExpressFees=e,e},totalAmount:function(){var e=0;return this.shoppings&&this.shoppings.forEach(function(t){e+=parseFloat(t.productQuantity*t.currentPrice)}),this.amount=parseFloat(e)+parseFloat(this.totalExpressFee),this.actualAmount=this.amount,this.coupon1&&(this.actualAmount=this.actualAmount-this.coupon1.minusMoney),this.coupon2&&(this.actualAmount=this.actualAmount-this.coupon2.minusMoney),this.amount=this.actualAmount,this.channel=this.balance>=this.amount?"balance":this.isMicroMessengerMobile?"jsApiWxpay":"alipay",this.amount}}}),l=c,u=(s("64a8"),s("2877")),p=Object(u["a"])(l,o,n,!1,null,"ffb01266",null);p.options.__file="Querendingdan.vue";t["default"]=p.exports},d117:function(e,t,s){}}]);